<!DOCTYPE html>
<html>
    <head>
        <title>Generateur simplifi√© d'attestation COVID-19</title>
        <style>
            * { font-family: Roboto, Verdana, Geneva, Tahoma, sans-serif; }
            .error  {color: red; }
        </style>
    </head>
    <body>
        <p>
            Votre attestation est en cours de g&eacute;n&eacute;ration.
        </p>
        <noscript>
            <p class="error">
                Vous devez activer le support JavaScript pour utiliser cette
                application.
            </p>
        </noscript>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment.min.js"></script>
        <script src="js/pdf-lib.min.js"></script>
        <script src="js/qrcode.min.js"></script>
        <script src="js/covidcert.js"></script>
        <script type="module">
            const url = new URL(document.location);
            const params = url.searchParams;
            const payload = params.get('payload');
            generate(payload).then(result => {
                const ua = navigator.userAgent.toLowerCase();
                const android = ua.indexOf("android") > -1;
                if (android) {
                    // NOTE: hidden clicked link do not work well with Android WebView.
                    window.open(result.url);
                }
                else {
                    const link = document.createElement('a');
                    link.href = result.url;
                    link.download = result.filename;
                    document.body.appendChild(link);
                    link.click();
                }
            });
        </script>
    </body>
</html>